<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Sensor Optimization</title>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />

    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>

<body>

    <div style="background-color:rgb(13, 25, 194); height:580px;">

        <!-- NAVBAR -->
        <nav class="navbar navbar-expand-md ">
            <div class="navbar-collapse collapse w-100 order-1 order-md-0 dual-collapse2">
                <ul class="navbar-nav mr-auto">
                    <img src="./logo.png" width="40" height="40" />
                    <li class="nav-item active">
                        <a class="nav-link" style="color:white;" href="#">Sensor Optimization</a>
                    </li>
                </ul>
            </div>
            <div class="mx-auto order-0">
                <a class="navbar-brand mx-auto" style="color:white;" href="#">Home</a>
            </div>
            <div class="mx-auto order-0">
                <a class="navbar-brand mx-auto" style="color:white;" href="#">Features</a>
            </div>
            <div class="mx-auto order-0">
                <a class="navbar-brand mx-auto" style="color:white;" href="#">FAQ</a>
            </div>
            <div class="navbar w-100 order-3 ">

            </div>
        </nav>

        <!-- FRAME FOR DRAG AND DROP -->
        <div class="frame">
            <p id="filename" style="font-weight:bold; margin-left:30px; text-align:left;">Filename: </p>
            <!-- WHERE WE SHOW THE PDF. -->
            <div id="pdf_display">
                
            </div>
            

        </div>

        <!-- BUTTONS FOR EITHER OPTIMIZING OR TOGGLING THE SETTINGS -->
        <div id="optimizationButtons" style="text-align: center; margin-top: 30px; display: block;">
            <button id="optimize" class="btn btn-primary"> Optimize </button>
            <button id="settings" class="btn btn-light">icon</button>
        </div>


        <!-- FRAME FOR THE USER TO CHANGE OPTIMIZATION SETTINGS -->
        <div class="optimizationFrame" style="display: none;">
            <div class="form-horizontal" style="margin-top: 30px;padding:90px;">


                <div class="row mb-4">
                    <label class="col-sm-4 col-form-label">Number of Sensors:</label>
                    <div class="col-sm-5">
                        <input type="text" class="form-control" id="amount">
                        <p id="amount_error" style="font-size:13px; color:red; display:none;">The number of sensors is not a number.</p>
                    </div>
                </div>

                <div class="row mb-4">
                    <label class="col-sm-4 col-form-label">Sensor Type:</label>
                    <div class="col-sm-5">
                        <input type="text" class="form-control" id="type">
                        <p id="type_error" style="font-size:13px; color:red; display:none;">The types of sensor is not a number.</p>
                    </div>
                </div>

                <div class="row mb-4">
                    <label class="col-sm-4 col-form-label">Areas to Ignore:</label>
                    <div class="col-sm-5">
                        <input type="text" class="form-control" id="areas">
                        <p id="areas_error" style="font-size:13px; color:red; display:none;">The areas to ignore is not a number.</p>
                    </div>
                </div>

                <button id="save_settings" class="btn btn-primary">Save Changes</button>
            </div>
        </div>

        <div id="optimized_complete" style="text-align: center; display: none;">
            <h4 style="color:green; margin-top:30px;"> Optimized!</h4>
        </div>

    </div>

    <script src="index.js"></script>
    <script>

        document.addEventListener("DOMContentLoaded", function (event) {

            const { ipcRenderer, remote, dialog } = require('electron')
            const $ = require("jquery")

            // CODE THAT GETS THE FILENAME OF THE PDF AND CHANGES THE #filename TO THIS FILENAME.
            $("#filename").html("Filename: " + localStorage.getItem('filepath').split("\\")[localStorage.getItem('filepath').split("\\").length -1]);

            // CODE THAT APPENDS THE PDF TO THE "pdf_display" DIV.
            $( "#pdf_display" ).append( "<embed src='"+localStorage.getItem('filepath')+"#toolbar=0&navpanes=0&scrollbar=0' type='application/pdf' width='100%' height='500px' />" );

            // CODE FOR WHEN THE USER HITS OPTIMIZATION BUTTON IN THE OPTIMIZATION UI.
            document.querySelector('#optimize').addEventListener('click', () => {

                const errors = checkUserInput()

                if ((!$("#optimizationButtons").is(":visible") && errors)||errors){
                    return $(".optimizationFrame").show()
                }

                $("#optimizationButtons").hide("fast", function () {
                    $("#optimized_complete").show("slow", function () {
                        console.log("TOGGLE DONE");
                    });
                });
            })

            // CODE FOR WHEN THE USER SAVES THE SETTINGS FOR THE OPTIMIZATION
            document.querySelector('#save_settings').addEventListener('click', () => {

                // HIDES THE OPTIMIZATION SETTINGS AND SHOWS THE BUTTONS AGAIN.
                $(".optimizationFrame").hide("slow", function () {
                    $("#optimizationButtons").show("slow", function () {
                        console.log("TOGGLE DONE");
                    });
                });
            })

            // CODE FOR WHEN THE USER HITS THE SETTINGS BUTTON IN THE OPTIMIZATION UI.
            document.querySelector('#settings').addEventListener('click', () => {

                // HIDES THE BUTTONS AND SHOWS THE OPTIMIZATION BOX INSTEAD.
                $("#optimizationButtons").hide("fast", function () {
                    $(".optimizationFrame").show("slow", function () {
                        console.log("TOGGLE DONE");
                    });
                });
            })

            // CHECKS THE USER INPUT FOR ERRORS, IF THERE ARE ERRORS, IT 
            // SHOWS THE ERRORS, OTHERWISE IT HIDES THEM.
            // TODO: Improve this shitty function.. It looks like a catastrophy.
            const checkUserInput = () =>{

                let errors = 0

                if(!$( "#amount" ).val().match(/^\d+$/)){
                    $("#amount_error").show()
                    errors = 1
                } else{
                    $("#amount_error").hide()
                }

                if(!$( "#type" ).val().match(/^\d+$/)){
                    $("#type_error").show()
                    errors = 1
                } else {
                    $("#type_error").hide()
                }
                
                if(!$( "#areas" ).val().match(/^\d+$/)){
                    $("#areas_error").show()
                    errors = 1
                } else {
                    $("#areas_error").hide()
                }

                return errors
            }

        });



    </script>
</body>

</html>